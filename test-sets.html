<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Clickable Sets - The Buzz Collection</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Inter:wght@300;400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <header class="header">
        <div class="logo">The Buzz Collection</div>
        <nav class="nav-links">
            <a href="index.html">Dashboard</a>
            <a href="collection.html">Collection</a>
            <a href="add.html">Add Card</a>
        </nav>
        <button class="menu-toggle" onclick="toggleMobileMenu()">☰</button>
    </header>

    <div class="container">
        <h1>Test Clickable Sets</h1>
        
        <div id="mainContent">
            <div class="inventory-section">
                <div class="section-header">
                    <h2>Sets Collected: 3</h2>
                    <div class="filter-controls">
                        <select id="setsFilter" class="filter-select">
                            <option value="emv-high">Est. Market Value (High to Low)</option>
                            <option value="emv-low">Est. Market Value (Low to High)</option>
                            <option value="cards-high">Number of Cards (High to Low)</option>
                            <option value="cards-low">Number of Cards (Low to High)</option>
                            <option value="year-newest">Newest to Oldest</option>
                            <option value="year-oldest">Oldest to Newest</option>
                        </select>
                    </div>
                </div>
                <div class="product-list" id="productList">
                    <!-- Test sets will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Mock card collection for testing
        const cardCollection = [
            {
                id: '1',
                year: 2023,
                product: 'Topps Chrome',
                category: 'Baseball',
                player: 'Mike Trout',
                team: 'Los Angeles Angels',
                cardNumber: '1',
                estimatedValue: 25.50,
                rookieCard: 'N',
                autograph: 'N',
                relic: 'N',
                parallel: 'N',
                numbered: 'N'
            },
            {
                id: '2',
                year: 2023,
                product: 'Topps Chrome',
                category: 'Baseball',
                player: 'Shohei Ohtani',
                team: 'Los Angeles Angels',
                cardNumber: '2',
                estimatedValue: 45.00,
                rookieCard: 'N',
                autograph: 'N',
                relic: 'N',
                parallel: 'N',
                numbered: 'N'
            },
            {
                id: '3',
                year: 2022,
                product: 'Panini Prizm',
                category: 'Basketball',
                player: 'LeBron James',
                team: 'Los Angeles Lakers',
                cardNumber: '1',
                estimatedValue: 35.75,
                rookieCard: 'N',
                autograph: 'N',
                relic: 'N',
                parallel: 'N',
                numbered: 'N'
            },
            {
                id: '4',
                year: 2022,
                product: 'Panini Prizm',
                category: 'Basketball',
                player: 'Stephen Curry',
                team: 'Golden State Warriors',
                cardNumber: '2',
                estimatedValue: 28.25,
                rookieCard: 'N',
                autograph: 'N',
                relic: 'N',
                parallel: 'N',
                numbered: 'N'
            },
            {
                id: '5',
                year: 2021,
                product: 'Upper Deck',
                category: 'Hockey',
                player: 'Connor McDavid',
                team: 'Edmonton Oilers',
                cardNumber: '1',
                estimatedValue: 15.00,
                rookieCard: 'N',
                autograph: 'N',
                relic: 'N',
                parallel: 'N',
                numbered: 'N'
            }
        ];

        // Function to handle set clicks and create individual set dashboard pages
        function handleSetClick(event) {
            const clickedSet = event.target.closest('.clickable-set');
            if (clickedSet) {
                event.preventDefault();
                event.stopPropagation();
                
                const year = clickedSet.getAttribute('data-year');
                const product = clickedSet.getAttribute('data-product');
                const category = clickedSet.getAttribute('data-category');
                const filename = clickedSet.getAttribute('data-filename');
                
                // Create the set-specific dashboard page
                createSetDashboard(year, product, category, filename);
            }
        }

        // Function to create a set-specific dashboard page
        function createSetDashboard(year, product, category, filename) {
            // Filter cards for this specific set
            const setCards = cardCollection.filter(card => 
                card.year == year && 
                card.product === product && 
                card.category === category
            );
            
            if (setCards.length === 0) {
                alert('No cards found for this set.');
                return;
            }
            
            // Create the HTML content for the set dashboard
            const setDashboardHTML = generateSetDashboardHTML(year, product, category, setCards);
            
            // Create a blob and download the file
            const blob = new Blob([setDashboardHTML], { type: 'text/html' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            window.URL.revokeObjectURL(url);
            
            // Also open the file in a new tab
            const newWindow = window.open('', '_blank');
            newWindow.document.write(setDashboardHTML);
            newWindow.document.close();
        }

        // Function to generate HTML for set-specific dashboard
        function generateSetDashboardHTML(year, product, category, setCards) {
            // Calculate set-specific stats
            const totalCards = setCards.length;
            const totalValue = setCards.reduce((sum, card) => {
                const value = card.estimatedValue;
                if (value === 'Unknown' || !value) return sum;
                return sum + parseFloat(value);
            }, 0);
            const rookieCards = setCards.filter(card => card.rookieCard === 'Y').length;
            const numberedCards = setCards.filter(card => card.numbered !== 'N').length;
            const autographCards = setCards.filter(card => card.autograph === 'Y').length;
            const relicCards = setCards.filter(card => card.relic === 'Y').length;
            
            // Get most valuable cards for this set
            const expensiveCards = [...setCards]
                .filter(card => card.estimatedValue !== 'Unknown' && card.estimatedValue > 0)
                .sort((a, b) => parseFloat(b.estimatedValue) - parseFloat(a.estimatedValue))
                .slice(0, 20);
            
            // Get all cards in this set for the detailed list
            const allSetCards = [...setCards].sort((a, b) => {
                // Sort by card number if available, otherwise by player name
                const aNum = parseInt(a.cardNumber) || 0;
                const bNum = parseInt(b.cardNumber) || 0;
                if (aNum !== bNum) return aNum - bNum;
                return (a.player || '').localeCompare(b.player || '');
            });
            
            return `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${year} ${product} ${category} - The Buzz Collection</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Inter:wght@300;400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <header class="header">
        <div class="logo">The Buzz Collection</div>
        <nav class="nav-links">
            <a href="index.html">Dashboard</a>
            <a href="collection.html">Collection</a>
            <a href="add.html">Add Card</a>
        </nav>
        <button class="menu-toggle" onclick="toggleMobileMenu()">☰</button>
    </header>

    <div class="container">
        <h1>${year} ${product} ${category} Set Dashboard</h1>
        
        <div id="mainContent">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number">${totalCards.toLocaleString()}</div>
                    <div class="stat-label">Total Cards in Set</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">$${totalValue.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</div>
                    <div class="stat-label">Estimated Market Value</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${rookieCards.toLocaleString()}</div>
                    <div class="stat-label">Rookie Cards</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${numberedCards.toLocaleString()}</div>
                    <div class="stat-label">Numbered Cards</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${autographCards.toLocaleString()}</div>
                    <div class="stat-label">Autographed Cards</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${relicCards.toLocaleString()}</div>
                    <div class="stat-label">Relic Cards</div>
                </div>
            </div>

            <div class="inventory-section">
                <h2>Most Valuable Cards in Set</h2>
                <div class="card-list" id="expensiveCards">
                    ${expensiveCards.length > 0 ? expensiveCards.map(card => {
                        const specialInfo = [];
                        if (card.rookieCard === 'Y') specialInfo.push('RC');
                        if (card.autograph === 'Y') specialInfo.push('Auto');
                        if (card.relic === 'Y') specialInfo.push('Relic');
                        if (card.parallel && card.parallel !== 'N') specialInfo.push(card.parallel);
                        if (card.numbered && card.numbered !== 'N') {
                            const numberedValue = card.numbered.startsWith("'") ? card.numbered.substring(1) : card.numbered;
                            specialInfo.push(numberedValue);
                        }
                        
                        const specialInfoLine = specialInfo.length > 0 ? 
                            `<div class="mini-card-special-info">${specialInfo.join(' | ')}</div>` : '';
                        
                        return `
                            <div class="mini-card">
                                <div class="mini-card-header">
                                    <div class="mini-card-player">${card.player || 'Unknown Player'}</div>
                                    <div class="mini-card-price-green">${parseFloat(card.estimatedValue).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</div>
                                </div>
                                <div class="mini-card-team">${card.team || 'Unknown'}</div>
                                <div class="mini-card-details">
                                    #${card.cardNumber || 'N/A'}
                                </div>
                                ${specialInfoLine}
                            </div>
                        `;
                    }).join('') : '<p style="color: #888; text-align: center; padding: 2rem;">No cards with estimated market value data in this set.</p>'}
                </div>
            </div>

            <div class="inventory-section">
                <h2>All Cards in Set</h2>
                <div class="card-list" id="allSetCards">
                    ${allSetCards.map(card => {
                        const specialInfo = [];
                        if (card.rookieCard === 'Y') specialInfo.push('RC');
                        if (card.autograph === 'Y') specialInfo.push('Auto');
                        if (card.relic === 'Y') specialInfo.push('Relic');
                        if (card.parallel && card.parallel !== 'N') specialInfo.push(card.parallel);
                        if (card.numbered && card.numbered !== 'N') {
                            const numberedValue = card.numbered.startsWith("'") ? card.numbered.substring(1) : card.numbered;
                            specialInfo.push(numberedValue);
                        }
                        
                        const specialInfoLine = specialInfo.length > 0 ? 
                            `<div class="mini-card-special-info">${specialInfo.join(' | ')}</div>` : '';
                        
                        const valueDisplay = card.estimatedValue && card.estimatedValue !== 'Unknown' ? 
                            `<div class="mini-card-price-green">$${parseFloat(card.estimatedValue).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</div>` : '';
                        
                        return `
                            <div class="mini-card">
                                <div class="mini-card-header">
                                    <div class="mini-card-player">${card.player || 'Unknown Player'}</div>
                                    ${valueDisplay}
                                </div>
                                <div class="mini-card-team">${card.team || 'Unknown'}</div>
                                <div class="mini-card-details">
                                    #${card.cardNumber || 'N/A'}
                                </div>
                                ${specialInfoLine}
                            </div>
                        `;
                    }).join('')}
                </div>
            </div>
        </div>
    </div>

    <script>
        function toggleMobileMenu() {
            const navLinks = document.querySelector('.nav-links');
            navLinks.classList.toggle('active');
        }
    </script>
</body>
</html>`;
        }

        // Display test sets
        function displayTestSets() {
            const productStats = {};
            cardCollection.forEach(card => {
                const productKey = `${card.year || 'Unknown'} ${card.product || 'Unknown'}`;
                const category = card.category || 'Unknown';
                const fullKey = `${productKey} ${category}`;
                
                if (!productStats[fullKey]) {
                    productStats[fullKey] = { 
                        count: 0, 
                        emv: 0, 
                        year: card.year || 'Unknown',
                        product: card.product || 'Unknown',
                        category: card.category || 'Unknown'
                    };
                }
                
                productStats[fullKey].count++;
                
                // Add EMV (Estimated Market Value)
                const value = card.estimatedValue;
                if (value !== 'Unknown' && value) {
                    productStats[fullKey].emv += parseFloat(value);
                }
            });

            const container = document.getElementById('productList');
            if (container) {
                container.innerHTML = Object.entries(productStats).map(([product, stats]) => {
                    // Create filename-safe version of the set name
                    const filename = `${stats.year}-${stats.product.replace(/[^a-zA-Z0-9]/g, '-')}-${stats.category.replace(/[^a-zA-Z0-9]/g, '-')}.html`;
                    
                    return `
                        <div class="product-item clickable-set" data-year="${stats.year}" data-product="${stats.product}" data-category="${stats.category}" data-filename="${filename}" style="cursor: pointer;">
                            <div class="product-info">
                                <div class="product-name">${product} <span class="click-indicator">→</span></div>
                                <div class="product-emv">EMV: $${stats.emv.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</div>
                            </div>
                            <div class="product-count">${stats.count}</div>
                        </div>
                    `;
                }).join('');
                
                // Add click event listeners to make sets clickable
                container.removeEventListener('click', handleSetClick);
                container.addEventListener('click', handleSetClick);
            }
        }

        function toggleMobileMenu() {
            const navLinks = document.querySelector('.nav-links');
            navLinks.classList.toggle('active');
        }

        // Initialize the test page
        displayTestSets();
    </script>
</body>
</html> 